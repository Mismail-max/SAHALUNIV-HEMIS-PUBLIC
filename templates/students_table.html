<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>All Students - Sahal University</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/bootstrap.min.css') }}">
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">  
  </style>
</head>
<body class="bg-light student-page">
<div class="container mt-5">

  <!-- Header -->
  <div class="text-center text-success mb-4">
    <h2 class="fw-bold">üìã All Students</h2>
    <p class="text-muted">You can search or expand to view all students</p>
  </div>

  <!-- Flash Messages -->
  {% with messages = get_flashed_messages(with_categories=true) %}
  {% if messages %}
    {% for category, message in messages %}
    <div class="alert alert-{{ category }} alert-dismissible fade show mt-3" role="alert">
      {{ message }}
      <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Close"></button>
    </div>
    {% endfor %}
  {% endif %}
  {% endwith %}

  <!-- Top Buttons -->
  <div class="btn-group-top mb-4 d-flex justify-content-between">
    <a href="/" class="btn btn-outline-primary">üè† Home</a>
    <button class="btn btn-outline-success" type="button" data-bs-toggle="collapse" data-bs-target="#studentTable" aria-expanded="false" aria-controls="studentTable">
      üìÇ Toggle Student Records
    </button>
  </div>

  <!-- Search Form -->
  <div class="card shadow-lg rounded-4 p-4 border-start border-5 search-card">
    <h6 class="mb-3 text-center text-primary">üîç  Get your Hemis ID, Search by Student ID</h6>
    <form method="POST">
      <div class="d-flex justify-content-center align-items-center" style="max-width: 1000px; width: 100%;">
        <input type="text" id="student_id" name="student_id" class="form-control me-2" style="max-width: 500px;" placeholder="Enter Student ID" required>
        <button type="submit" class="btn btn-primary">Search</button>
      </div>

    </form>
  </div>

  <!-- Student Table (Collapsible) -->
  {% if all_students %}
  <div class="collapse show" id="studentTable">
    <div class="card shadow-lg rounded-4 p-4 mt-4">
      <div class="scroll-table-wrapper">
        <table class="table table-hover table-bordered align-middle text-center">
          <thead class="table-success">
            <tr>
              <th>Hemis RegNumber</th>
              <th>Student ID</th>
              <th>Name</th>
              <th>Mother Name</th>
              <th>Sex</th>
              <th>Birth Date</th>
              <th>Address</th>
              <th>Phone</th>
              <th>Email</th>
              <th>Emergency Contact</th>
              <th>Emergency Phone</th>
              <th>Enrollment Date</th>
              <th>Certificate</th>
              <th>Roll #</th>
              <th>Foculty</th>
              <th>Department</th>
              <th>Program</th>
              <th>Academic Year</th>
              <th>Class Year</th>
              <th>Semester</th>
              <th>Status</th>
              <th>Degree</th>
              <th>Created By</th>
              <th>Updated By</th>
              <th>Mode</th>
              <th>Medium</th>
              <th>University</th>
              <th>National ID</th>
              <th>Nationality</th>
              <th>Bachelor Degree From</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            {% for row in all_students %}
            <tr>
              <td>{{ row.hemis_reg_number }}</td>
              <td>{{ row.student_id }}</td>
              <td>{{ row.name }}</td>
              <td>{{ row.mother_name }}</td>
              <td>{{ row.sex }}</td>
              <td>{{ row.birth_date }}</td>
              <td>{{ row.address }}</td>
              <td>{{ row.phone }}</td>
              <td>{{ row.email }}</td>
              <td>{{ row.emergency_contact }}</td>
              <td>{{ row.emergency_contact_phone }}</td>
              <td>{{ row.enrollment_date }}</td>
              <td>{{ row.certificate_type }}</td>
              <td>{{ row.school_roll_number }}</td>
              <td>{{ row.foculty }}</td>
              <td>{{ row.department }}</td>
              <td>{{ row.program }}</td>
              <td>{{ row.academic_year }}</td>
              <td>{{ row.class_year }}</td>
              <td>{{ row.semester }}</td>
              <td>{{ row.status }}</td>
              <td>{{ row.degree }}</td>
              <td>{{ row.created_by }}</td>
              <td>{{ row.updated_by }}</td>
              <td>{{ row.mode_of_study }}</td>
              <td>{{ row.instruction_medium }}</td>
              <td>{{ row.university }}</td>
              <td>{{ row.national_id }}</td>
              <td>{{ row.nationality }}</td>
              <td>{{ row.bachelor_degree_graduate_from }}</td>
              <td>
                <form method="POST" action="/delete/{{ row.hemis_reg_number }}" onsubmit="return confirm('Are you sure you want to delete this student?');">
                  <button type="submit" class="btn btn-sm btn-danger">üóë Delete</button>
                </form>
              </td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>

      <!-- Pagination -->
      <nav aria-label="Page navigation">
        <ul class="pagination justify-content-center mt-4">
          {% if page > 1 %}
            <li class="page-item">
              <a class="page-link" href="/students?page={{ page - 1 }}">¬´ Prev</a>
            </li>
          {% endif %}
      
          {% set start_page = page %}
          {% set end_page = [page + 9, total_pages, 100]|min %}
      
          {% if start_page > 1 %}
            <li class="page-item"><a class="page-link" href="/students?page=1">1</a></li>
            {% if start_page > 2 %}
              <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
          {% endif %}
      
          {% for p in range(start_page, end_page + 1) %}
            <li class="page-item {% if p == page %}active{% endif %}">
              <a class="page-link" href="/students?page={{ p }}">{{ p }}</a>
            </li>
          {% endfor %}
      
          {% if end_page < total_pages %}
            {% if end_page < total_pages - 1 %}
              <li class="page-item disabled"><span class="page-link">...</span></li>
            {% endif %}
            <li class="page-item"><a class="page-link" href="/students?page={{ total_pages }}">{{ total_pages }}</a></li>
          {% endif %}
      
          {% if page < total_pages %}
            <li class="page-item">
              <a class="page-link" href="/students?page={{ page + 1 }}">Next ¬ª</a>
            </li>
          {% endif %}
        </ul>
      </nav>

    </div>
  </div>
  {% endif %}
</div>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
</body>
</html>
